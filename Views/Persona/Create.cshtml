@model inmobiliariaULP.Models.Persona

@{
    ViewData["Title"] = "Crear Persona";
}

<div class="container mt-4">
    <h2 class="text-primary mb-4">
        <i class="bi bi-person-plus me-2"></i>Crear Nueva Persona
    </h2>


    <form asp-action="@(Model?.PersonaId > 0 ? "Edit" : "Create")" asp-controller="Persona" class="needs-validation" novalidate>
        
        @if (Model?.PersonaId > 0)
        {
            <input type="hidden" asp-for="PersonaId" />
        }

        <!-- Información Personal -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <label asp-for="Dni" class="form-label"></label>
                <input asp-for="Dni" class="form-control" maxlength="8" />
                <span asp-validation-for="Dni" class="text-danger"></span>
                <div class="form-text">8 dígitos numéricos</div>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="Apellido" class="form-label"></label>
                <input asp-for="Apellido" class="form-control" />
                <span asp-validation-for="Apellido" class="text-danger"></span>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="Nombre" class="form-label"></label>
                <input asp-for="Nombre" class="form-control" />
                <span asp-validation-for="Nombre" class="text-danger"></span>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="Telefono" class="form-label"></label>
                <input asp-for="Telefono" class="form-control" />
                <span asp-validation-for="Telefono" class="text-danger"></span>
            </div>

            <div class="col-12 mb-3">
                <label asp-for="Email" class="form-label"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>
        </div>

        <!-- Rol único (solo Inquilino o Propietario) -->
        <div class="row mb-4">
            <div class="col-12">
                <label class="form-label d-block mb-3">Tipo de Persona</label>                
                <div class="d-flex gap-3 flex-wrap">                    
                    <!-- Inquilino -->
                    <div class="card flex-fill text-center tipo-persona-card border-primary p-3" style="cursor:pointer; min-width:12rem;">
                        <div class="card-body">
                            <i class="bi bi-house-door-fill display-4 text-primary"></i>
                            <p class="mt-2 mb-0 fw-semibold">Inquilino</p>
                            <input 
                                type="checkbox" 
                                asp-for="TipoPersona" 
                                value="inquilino" 
                                class="form-check-input mt-2" 
                                style="transform: scale(1.5);" 
                                checked="@(Model.TipoPersona != null && Model.TipoPersona.Contains("inquilino") ? "checked" : null)"
                            />
                        </div>
                    </div>
        
                    <!-- Propietario -->
                    <div class="card flex-fill text-center tipo-persona-card border-success p-3" style="cursor:pointer; min-width:12rem;">
                        <div class="card-body">
                            <i class="bi bi-person-fill display-4 text-success"></i>
                            <p class="mt-2 mb-0 fw-semibold">Propietario</p>
                            <input 
                                type="checkbox" 
                                asp-for="TipoPersona" 
                                value="propietario" 
                                class="form-check-input mt-2" 
                                style="transform: scale(1.5);" 
                                checked="@(Model.TipoPersona != null && Model.TipoPersona.Contains("propietario") ? "checked" : null)"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-circle me-2"></i>Crear Persona
        </button>
        <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
    </form>



</div>

@section Scripts
{
    <script>
        const rolEmpleado = document.getElementById('rolEmpleado');
        const camposEmpleado = document.getElementById('camposEmpleado');
        const esUsuario = document.getElementById('esUsuario');
        const camposUsuario = document.getElementById('camposUsuario');

        document.querySelectorAll('input[name="TipoPersona"]').forEach(r => {
            r.addEventListener('change', () => {
                
                document.querySelectorAll('input[name="TipoPersona"]').forEach( check => check.classList.remove('selected');
                r.classList.add('selected');
                r.querySelector('input[type="checkbox"]').checked = true;

            });
        });

        

        if (esUsuario) {
            esUsuario.addEventListener('change', function () {
                if (camposUsuario) {
                    camposUsuario.style.display = this.checked ? 'flex' : 'none';
                }
            });
        }

        // Selección visual de card - Create
        const cards = document.querySelectorAll('.tipo-persona-card');
        cards.forEach(card => {
            const checkbox = card.querySelector('input[type="checkbox"]');

             // Si al cargar la página el checkbox está marcado, marcar la card
            if (checkbox.checked) 
                card.classList.add('selected');


            // Cuando se hace click en la card, actualizar selección
            card.addEventListener('click', () => {
                cards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                checkbox.checked = true;
            });
        });

    </script>
}
