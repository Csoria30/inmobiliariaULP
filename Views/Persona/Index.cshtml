@model IEnumerable<Persona>

@{
    ViewData["Title"] = "Home Page";
}

<div class="container-fluid px-4 py-5">
    <!-- Header con título y botón de crear -->
    <div class="row align-items-center mb-4">
        <div class="col">
            <h1 class="h2 fw-bold text-primary mb-0">
                <i class="bi bi-people-fill me-2"></i>Gestión de Personas
            </h1>
            <p class="text-muted mb-0">Administra la información de todas las personas</p>
        </div>
        <div class="col-auto">
		    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#crearPersonaModal">
		    	<i class="bi bi-plus-circle me-2"></i>Nueva Persona
		    </button>
	    </div>
    </div>

    <!-- Tabla Personas -->
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="personasTable">
                <thead class="table-light">
                    <tr>
                        <th class="border-0">
                            <i class="bi bi-card-text me-1"></i>DNI
                        </th>
                        <th class="border-0">
                            <i class="bi bi-person me-1"></i>Apellido
                        </th>
                        <th class="border-0">
                            <i class="bi bi-person me-1"></i>Nombre
                        </th>
                        <th class="border-0">
                            <i class="bi bi-telephone me-1"></i>Teléfono
                        </th>
                        <th class="border-0">
                            <i class="bi bi-envelope me-1"></i>Email
                        </th>
                        <th class="border-0 text-center" style="width: 200px;">
                            <i class="bi bi-gear me-1"></i>Acciones
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var persona in Model)
                        {
                            <tr>
                                <td class="align-middle">
                                    <span class="badge bg-light text-dark fw-normal">@persona.Dni</span>
                                </td>
                                <td class="align-middle fw-medium">@persona.Apellido</td>
                                <td class="align-middle">@persona.Nombre</td>
                                <td class="align-middle">@persona.Telefono</td>
                                <td class="align-middle">@persona.Email</td>

                                <td class="align-middle">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-info" 
                                                data-bs-toggle="tooltip" data-bs-placement="top" 
                                                title="Mas informacion" onclick="">
                                            <i class="bi bi-info-circle"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-warning" 
                                                data-bs-toggle="tooltip" data-bs-placement="top" 
                                                title="Editar Persona" onclick="">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                                data-bs-toggle="tooltip" data-bs-placement="top" 
                                                title="Eliminar Persona" onclick="">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }

                    }
                    else
                    {
                        <tr>
                            <td colspan="6">No hay personas para mostrar.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div><!-- Tabla Personas -->

    <!-- Modal para Crear Nueva Persona (rol único) -->
    <div class="modal fade" id="crearPersonaModal" tabindex="-1" aria-labelledby="crearPersonaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="crearPersonaModalLabel">
                        <i class="bi bi-person-plus me-2"></i>Nueva Persona
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="formCrearPersona">
                    <div class="modal-body">
                        <!-- Información Personal -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary fw-semibold mb-3">
                                    <i class="bi bi-person-badge me-2"></i>Información Personal
                                </h6>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="dni" class="form-label fw-medium">
                                    <i class="bi bi-card-text me-1"></i>DNI *
                                </label>
                                <input type="text" class="form-control" id="dni" name="dni" required placeholder="Ej: 12345678" maxlength="8">
                                <div class="form-text">8 dígitos numéricos</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="apellido" class="form-label fw-medium">
                                    <i class="bi bi-person me-1"></i>Apellido *
                                </label>
                                <input type="text" class="form-control" id="apellido" name="apellido" required placeholder="Ej: González">
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="nombre" class="form-label fw-medium">
                                    <i class="bi bi-person me-1"></i>Nombre *
                                </label>
                                <input type="text" class="form-control" id="nombre" name="nombre" required placeholder="Ej: Juan Carlos">
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="telefono" class="form-label fw-medium">
                                    <i class="bi bi-telephone me-1"></i>Teléfono *
                                </label>
                                <input type="tel" class="form-control" id="telefono" name="telefono" required placeholder="Ej: 011-1234-5678">
                            </div>

                            <div class="col-12 mb-3">
                                <label for="email" class="form-label fw-medium">
                                    <i class="bi bi-envelope me-1"></i>Email *
                                </label>
                                <input type="email" class="form-control" id="email" name="email" required placeholder="Ej: juan@mail.com">
                            </div>
                        </div>

                        <!-- Rol único -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary fw-semibold mb-3">
                                    <i class="bi bi-tags me-2"></i>Rol de la Persona (único)
                                </h6>
                            </div>

                            <div class="col-md-4 mb-3">
                                <div class="form-check border rounded p-3 h-100">
                                    <input class="form-check-input" type="radio" name="tipoPersona" id="rolInquilino" value="inquilino" required>
                                    <label class="form-check-label fw-medium" for="rolInquilino">
                                        <i class="bi bi-house-door text-success me-2"></i>Inquilino
                                    </label>
                                    <div class="form-text small">Persona que alquila propiedades</div>
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <div class="form-check border rounded p-3 h-100">
                                    <input class="form-check-input" type="radio" name="tipoPersona" id="rolPropietario" value="propietario" required>
                                    <label class="form-check-label fw-medium" for="rolPropietario">
                                        <i class="bi bi-building text-primary me-2"></i>Propietario
                                    </label>
                                    <div class="form-text small">Persona que posee propiedades</div>
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <div class="form-check border rounded p-3 h-100">
                                    <input class="form-check-input" type="radio" name="tipoPersona" id="rolEmpleado" value="empleado" required>
                                    <label class="form-check-label fw-medium" for="rolEmpleado">
                                        <i class="bi bi-briefcase text-warning me-2"></i>Empleado
                                    </label>
                                    <div class="form-text small">Trabaja en la inmobiliaria</div>
                                </div>
                            </div>
                        </div>

                        <!-- Campos adicionales para Empleado -->
                        <div id="camposEmpleado" class="row mb-4" style="display: none;">
                            <div class="col-12">
                                <h6 class="text-warning fw-semibold mb-3">
                                    <i class="bi bi-briefcase me-2"></i>Información de Empleado
                                </h6>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="esUsuario" name="esUsuario">
                                    <label class="form-check-label fw-medium" for="esUsuario">
                                        <i class="bi bi-person-badge text-info me-2"></i>Crear Usuario del Sistema
                                    </label>
                                </div>
                            </div>

                            <div id="camposUsuario" class="row" style="display: none;">
                                <div class="col-md-6 mb-3">
                                    <label for="password" class="form-label fw-medium">
                                        <i class="bi bi-lock me-1"></i>Contraseña *
                                    </label>
                                    <input type="password" class="form-control" id="password" name="password" placeholder="Mínimo 6 caracteres">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="rolUsuario" class="form-label fw-medium">
                                        <i class="bi bi-shield me-1"></i>Rol *
                                    </label>
                                    <select class="form-select" id="rolUsuario" name="rolUsuario">
                                        <option value="">Seleccionar rol...</option>
                                        <option value="empleado">Empleado</option>
                                        <option value="administrador">Administrador</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                    </div><!-- modal-body -->

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-2"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Crear Persona
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div> <!-- Modal para Crear Nueva Persona (rol único) -->

@section Scripts
{
    <script>
        // Mostrar/ocultar campos de empleado según rol
        const rolRadios = document.querySelectorAll('input[name="tipoPersona"]');
        const camposEmpleado = document.getElementById('camposEmpleado');
        const esUsuario = document.getElementById('esUsuario');
        const camposUsuario = document.getElementById('camposUsuario');

        function actualizarVisibilidadPorRol() {
            const seleccionado = document.querySelector('input[name="tipoPersona"]:checked');
            const esEmpleado = seleccionado && seleccionado.value === 'empleado';
            camposEmpleado.style.display = esEmpleado ? 'flex' : 'none';

            if (!esEmpleado) {
                esUsuario.checked = false;
                camposUsuario.style.display = 'none';
            }
        }

        rolRadios.forEach(r => r.addEventListener('change', actualizarVisibilidadPorRol));
        esUsuario.addEventListener('change', function () {
            camposUsuario.style.display = this.checked ? 'flex' : 'none';
        });

    </script>
}

</div>

